/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package views;

import DAO.NhaXuatBanDao;
import DAO.SachDAO;
import DAO.TacGiaDao;
import DAO.TacGiaVaSachDao;
import DAO.TheLoaiDao;
import DAO.TheLoaiVaSachDao;
import Helper.MsgBox;
import Models.NhaXuatBan;
import Models.Sach;
import Models.TacGia;
import Models.TacGiaVaSach;
import Models.TheLoai;
import Models.TheLoaiVaSach;
import java.sql.Date;
import java.util.Calendar;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.DefaultComboBoxModel;
import javax.swing.ImageIcon;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Nguyen Hoan
 */
public class QLSach_JPanel extends javax.swing.JPanel {

    private Map<Integer, List<Sach>> listSach;
    private Map<Long, TacGia> listTacGia;
    private Map<Long, TheLoai> listTheLoai;
    private List<NhaXuatBan> listNhaXuatBan;

    private Map<Long, Long> theLoaiAdd;
    private Map<Long, Long> tacGiaAdd;

    private DefaultTableModel tableModelListSach;
    private DefaultTableModel tableModelListTacGia;
    private DefaultTableModel tableModelListTheLoais;

    private DefaultComboBoxModel boxModelTheLoai;
    private DefaultComboBoxModel boxModelNhaXuatBan;
    private DefaultComboBoxModel boxModelKhuVuc;
    private int pageIndex = 0;
    private int total;

    private TheLoaiVaSachDao theLoaiVaSachDao;
    private TacGiaVaSachDao tacGiaVaSachDao;
    private TheLoaiDao theLoaiDao;
    private NhaXuatBanDao nhaXuatBanDao;
    private TacGiaDao tacGiaDao;
    private SachDAO sachDAO;
    private static QLSach_JPanel instance;

    /**
     * Creates new form QLSach_JPanel
     */
    private QLSach_JPanel() {
        initComponents();
        jTabbedPane1.remove(jPanelCapNhat);

        theLoaiDao = TheLoaiDao.getInstance();
        nhaXuatBanDao = NhaXuatBanDao.getInstance();
        sachDAO = SachDAO.getInstance();
        tacGiaDao = TacGiaDao.getInstance();
        tacGiaVaSachDao = TacGiaVaSachDao.getInstacne();
        theLoaiVaSachDao = TheLoaiVaSachDao.getInstacne();
        total = sachDAO.getTotal();

        theLoaiAdd = new HashMap<Long, Long>();
        tacGiaAdd = new HashMap<Long, Long>();

        listTacGia = new HashMap<Long, TacGia>();
        listTheLoai = new HashMap<Long, TheLoai>();
        listNhaXuatBan = nhaXuatBanDao.selectALL();

        listSach = new HashMap<Integer, List<Sach>>();
        listSach.put(pageIndex, sachDAO.selectByPage(Long.valueOf(pageIndex)));

        loadList();

        tableModelListSach = (DefaultTableModel) tblSach.getModel();
        tableModelListTacGia = (DefaultTableModel) tblTacGia.getModel();
        tableModelListTheLoais = (DefaultTableModel) tblTheLoai.getModel();

        boxModelKhuVuc = (DefaultComboBoxModel) cmbKhuVuc.getModel();
        boxModelNhaXuatBan = (DefaultComboBoxModel) cmbNhaXuatBan.getModel();
        boxModelTheLoai = (DefaultComboBoxModel) cmbTheLoaiFilter.getModel();

        fillCmbKhuVuc();
        fillCmbNhaXuatBan();
        fillCmbTheLoai();
        fillTableSach(listSach.get(pageIndex));
    }

    public static QLSach_JPanel getInstance() {
        if (instance == null) {
            instance = new QLSach_JPanel();
        }
        return instance;

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel9 = new javax.swing.JLabel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel2 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblSach = new javax.swing.JTable();
        jPanel3 = new javax.swing.JPanel();
        jPanel11 = new javax.swing.JPanel();
        jPanel9 = new javax.swing.JPanel();
        btnAddNew = new javax.swing.JButton();
        btnDetails = new javax.swing.JButton();
        btnNhapSach = new javax.swing.JButton();
        jPanel10 = new javax.swing.JPanel();
        cmbTheLoaiFilter = new javax.swing.JComboBox<>();
        jPanel12 = new javax.swing.JPanel();
        txtSearch = new javax.swing.JTextField();
        btnSearch = new javax.swing.JButton();
        jPanel6 = new javax.swing.JPanel();
        btnLamMoi = new javax.swing.JButton();
        jPanel7 = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        btnFirst = new javax.swing.JButton();
        btnPrev = new javax.swing.JButton();
        btnNext = new javax.swing.JButton();
        btnLast = new javax.swing.JButton();
        jPanel8 = new javax.swing.JPanel();
        jPanelCapNhat = new javax.swing.JPanel();
        jPanel4 = new javax.swing.JPanel();
        jPanel13 = new javax.swing.JPanel();
        jPanel15 = new javax.swing.JPanel();
        btnNhaXuatBan = new javax.swing.JButton();
        cmbNhaXuatBan = new javax.swing.JComboBox<>();
        lblNhaXuatBan1 = new javax.swing.JLabel();
        lblViTri = new javax.swing.JLabel();
        cmbKhuVuc = new javax.swing.JComboBox<>();
        lblErrorTenSach = new javax.swing.JLabel();
        txtTenSach = new javax.swing.JTextField();
        txtMaSach = new javax.swing.JTextField();
        lblMaSach = new javax.swing.JLabel();
        lblTenSach = new javax.swing.JLabel();
        jPanel14 = new javax.swing.JPanel();
        jPanel5 = new javax.swing.JPanel();
        lblQr_Code = new javax.swing.JLabel();
        btnDownload = new javax.swing.JButton();
        jPanel17 = new javax.swing.JPanel();
        jPanel19 = new javax.swing.JPanel();
        jPanel20 = new javax.swing.JPanel();
        jPanel21 = new javax.swing.JPanel();
        jPanel22 = new javax.swing.JPanel();
        jPanel16 = new javax.swing.JPanel();
        btnQuayLai = new javax.swing.JButton();
        btnClear = new javax.swing.JButton();
        btnAdd = new javax.swing.JButton();
        jPanel28 = new javax.swing.JPanel();
        jPanel23 = new javax.swing.JPanel();
        jPanel29 = new javax.swing.JPanel();
        jPanel30 = new javax.swing.JPanel();
        jPanel31 = new javax.swing.JPanel();
        jPanel27 = new javax.swing.JPanel();
        jPanel18 = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        tblTheLoai = new javax.swing.JTable();
        jPanel26 = new javax.swing.JPanel();
        btnChonTheLoai = new javax.swing.JButton();
        btnXoaTheLoai = new javax.swing.JButton();
        jPanel24 = new javax.swing.JPanel();
        jScrollPane3 = new javax.swing.JScrollPane();
        tblTacGia = new javax.swing.JTable();
        jPanel25 = new javax.swing.JPanel();
        btnXoaTacGia = new javax.swing.JButton();
        btnChonTacGia = new javax.swing.JButton();
        jPanel32 = new javax.swing.JPanel();
        jPanel33 = new javax.swing.JPanel();
        jPanel34 = new javax.swing.JPanel();
        jPanel35 = new javax.swing.JPanel();

        setBackground(new java.awt.Color(255, 255, 255));
        setLayout(new java.awt.BorderLayout());

        jLabel9.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel9.setForeground(new java.awt.Color(0, 153, 0));
        jLabel9.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel9.setText("QUẢN LÝ SÁCH");
        jLabel9.setPreferredSize(new java.awt.Dimension(95, 100));
        add(jLabel9, java.awt.BorderLayout.PAGE_START);

        jPanel2.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1));
        jPanel2.setLayout(new java.awt.BorderLayout(0, 10));

        jScrollPane1.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jScrollPane1.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        jScrollPane1.setColumnHeaderView(null);

        tblSach.setAutoCreateRowSorter(true);
        tblSach.setFont(new java.awt.Font("Segoe UI", 0, 12)); // NOI18N
        tblSach.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã sách", "Tên sách", "Vị Trí", "Ngày tạo"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, true, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblSach.setGridColor(new java.awt.Color(255, 255, 255));
        tblSach.setIntercellSpacing(new java.awt.Dimension(0, 0));
        tblSach.setRowHeight(25);
        tblSach.setSelectionBackground(new java.awt.Color(6, 143, 202));
        jScrollPane1.setViewportView(tblSach);
        if (tblSach.getColumnModel().getColumnCount() > 0) {
            tblSach.getColumnModel().getColumn(2).setResizable(false);
        }

        jPanel2.add(jScrollPane1, java.awt.BorderLayout.CENTER);

        jPanel3.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel3.setPreferredSize(new java.awt.Dimension(648, 90));
        jPanel3.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 20, 5));

        jPanel11.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel11.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 10, 15));

        jPanel9.setLayout(new java.awt.GridLayout(1, 0, 10, 0));

        btnAddNew.setText("Thêm Mới");
        btnAddNew.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAddNewActionPerformed(evt);
            }
        });
        jPanel9.add(btnAddNew);

        btnDetails.setText("Chi Tiết");
        btnDetails.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDetailsActionPerformed(evt);
            }
        });
        jPanel9.add(btnDetails);

        btnNhapSach.setText("Nhập Sách");
        btnNhapSach.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnNhapSachActionPerformed(evt);
            }
        });
        jPanel9.add(btnNhapSach);

        jPanel11.add(jPanel9);

        jPanel3.add(jPanel11);

        jPanel10.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), "Thể loại"));

        cmbTheLoaiFilter.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cmbTheLoaiFilter.setPreferredSize(new java.awt.Dimension(200, 35));
        cmbTheLoaiFilter.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbTheLoaiFilterActionPerformed(evt);
            }
        });
        jPanel10.add(cmbTheLoaiFilter);

        jPanel3.add(jPanel10);

        jPanel12.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel12.setPreferredSize(new java.awt.Dimension(306, 65));

        btnSearch.setText("Tìm kiếm");
        btnSearch.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSearchActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel12Layout = new javax.swing.GroupLayout(jPanel12);
        jPanel12.setLayout(jPanel12Layout);
        jPanel12Layout.setHorizontalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel12Layout.createSequentialGroup()
                .addGap(27, 27, 27)
                .addComponent(txtSearch, javax.swing.GroupLayout.DEFAULT_SIZE, 174, Short.MAX_VALUE)
                .addGap(18, 18, 18)
                .addComponent(btnSearch)
                .addContainerGap())
        );
        jPanel12Layout.setVerticalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel12Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnSearch, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtSearch, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(31, 31, 31))
        );

        jPanel3.add(jPanel12);

        jPanel2.add(jPanel3, java.awt.BorderLayout.PAGE_START);

        jPanel6.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel6.setLayout(new java.awt.BorderLayout(10, 0));

        btnLamMoi.setText("Làm mới");
        btnLamMoi.setPreferredSize(new java.awt.Dimension(100, 35));
        btnLamMoi.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLamMoiActionPerformed(evt);
            }
        });
        jPanel6.add(btnLamMoi, java.awt.BorderLayout.LINE_START);

        jPanel7.setPreferredSize(new java.awt.Dimension(100, 15));

        javax.swing.GroupLayout jPanel7Layout = new javax.swing.GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 984, Short.MAX_VALUE)
        );
        jPanel7Layout.setVerticalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 15, Short.MAX_VALUE)
        );

        jPanel6.add(jPanel7, java.awt.BorderLayout.PAGE_START);

        jPanel1.setPreferredSize(new java.awt.Dimension(330, 35));
        jPanel1.setLayout(new java.awt.GridLayout(1, 0, 20, 0));

        btnFirst.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images_Icon/First_button.png"))); // NOI18N
        btnFirst.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnFirstActionPerformed(evt);
            }
        });
        jPanel1.add(btnFirst);

        btnPrev.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images_Icon/back_button.png"))); // NOI18N
        btnPrev.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPrevActionPerformed(evt);
            }
        });
        jPanel1.add(btnPrev);

        btnNext.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images_Icon/next_button.png"))); // NOI18N
        btnNext.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnNextActionPerformed(evt);
            }
        });
        jPanel1.add(btnNext);

        btnLast.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images_Icon/Last_button.png"))); // NOI18N
        btnLast.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLastActionPerformed(evt);
            }
        });
        jPanel1.add(btnLast);

        jPanel6.add(jPanel1, java.awt.BorderLayout.LINE_END);

        jPanel8.setPreferredSize(new java.awt.Dimension(970, 20));

        javax.swing.GroupLayout jPanel8Layout = new javax.swing.GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 984, Short.MAX_VALUE)
        );
        jPanel8Layout.setVerticalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 20, Short.MAX_VALUE)
        );

        jPanel6.add(jPanel8, java.awt.BorderLayout.PAGE_END);

        jPanel2.add(jPanel6, java.awt.BorderLayout.PAGE_END);

        jTabbedPane1.addTab("Danh sách", jPanel2);

        jPanelCapNhat.setLayout(new java.awt.BorderLayout());

        jPanel4.setPreferredSize(new java.awt.Dimension(800, 700));
        jPanel4.setLayout(new java.awt.BorderLayout(10, 10));

        jPanel13.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel13.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 50, 15));

        jPanel15.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel15.setPreferredSize(new java.awt.Dimension(470, 210));
        jPanel15.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        btnNhaXuatBan.setText("Thêm mới");
        btnNhaXuatBan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnNhaXuatBanActionPerformed(evt);
            }
        });
        jPanel15.add(btnNhaXuatBan, new org.netbeans.lib.awtextra.AbsoluteConstraints(370, 160, -1, -1));

        cmbNhaXuatBan.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        jPanel15.add(cmbNhaXuatBan, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 160, 236, 30));

        lblNhaXuatBan1.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lblNhaXuatBan1.setText("Nhà xuất bản:");
        jPanel15.add(lblNhaXuatBan1, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 160, -1, 30));

        lblViTri.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lblViTri.setText("Vị trí:");
        jPanel15.add(lblViTri, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 110, 70, 30));

        cmbKhuVuc.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cmbKhuVuc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbKhuVucActionPerformed(evt);
            }
        });
        jPanel15.add(cmbKhuVuc, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 110, 236, 30));

        lblErrorTenSach.setText(" ");
        jPanel15.add(lblErrorTenSach, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 80, 236, -1));

        txtTenSach.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtTenSach.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtTenSachActionPerformed(evt);
            }
        });
        jPanel15.add(txtTenSach, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 50, 236, 30));

        txtMaSach.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txtMaSach.setEnabled(false);
        jPanel15.add(txtMaSach, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 10, 236, 30));

        lblMaSach.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lblMaSach.setText("Mã sách:");
        jPanel15.add(lblMaSach, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 10, -1, 30));

        lblTenSach.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lblTenSach.setText("Tên sách:");
        jPanel15.add(lblTenSach, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 50, -1, 30));

        jPanel13.add(jPanel15);

        jPanel14.setBorder(null);
        jPanel14.setLayout(new java.awt.BorderLayout(10, 10));

        jPanel5.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel5.setPreferredSize(new java.awt.Dimension(200, 200));
        jPanel5.setLayout(new java.awt.BorderLayout());
        jPanel5.add(lblQr_Code, java.awt.BorderLayout.CENTER);

        jPanel14.add(jPanel5, java.awt.BorderLayout.CENTER);

        btnDownload.setText("Download");
        btnDownload.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDownloadActionPerformed(evt);
            }
        });
        jPanel14.add(btnDownload, java.awt.BorderLayout.PAGE_END);

        jPanel13.add(jPanel14);

        jPanel4.add(jPanel13, java.awt.BorderLayout.PAGE_START);

        jPanel17.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel17.setPreferredSize(new java.awt.Dimension(910, 60));
        jPanel17.setLayout(new java.awt.BorderLayout(20, 0));

        javax.swing.GroupLayout jPanel19Layout = new javax.swing.GroupLayout(jPanel19);
        jPanel19.setLayout(jPanel19Layout);
        jPanel19Layout.setHorizontalGroup(
            jPanel19Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );
        jPanel19Layout.setVerticalGroup(
            jPanel19Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );

        jPanel17.add(jPanel19, java.awt.BorderLayout.LINE_START);

        javax.swing.GroupLayout jPanel20Layout = new javax.swing.GroupLayout(jPanel20);
        jPanel20.setLayout(jPanel20Layout);
        jPanel20Layout.setHorizontalGroup(
            jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );
        jPanel20Layout.setVerticalGroup(
            jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );

        jPanel17.add(jPanel20, java.awt.BorderLayout.LINE_END);

        jPanel21.setPreferredSize(new java.awt.Dimension(70, 10));

        javax.swing.GroupLayout jPanel21Layout = new javax.swing.GroupLayout(jPanel21);
        jPanel21.setLayout(jPanel21Layout);
        jPanel21Layout.setHorizontalGroup(
            jPanel21Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 946, Short.MAX_VALUE)
        );
        jPanel21Layout.setVerticalGroup(
            jPanel21Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 10, Short.MAX_VALUE)
        );

        jPanel17.add(jPanel21, java.awt.BorderLayout.PAGE_START);

        jPanel22.setPreferredSize(new java.awt.Dimension(906, 10));

        javax.swing.GroupLayout jPanel22Layout = new javax.swing.GroupLayout(jPanel22);
        jPanel22.setLayout(jPanel22Layout);
        jPanel22Layout.setHorizontalGroup(
            jPanel22Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 946, Short.MAX_VALUE)
        );
        jPanel22Layout.setVerticalGroup(
            jPanel22Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 10, Short.MAX_VALUE)
        );

        jPanel17.add(jPanel22, java.awt.BorderLayout.PAGE_END);

        jPanel16.setPreferredSize(new java.awt.Dimension(600, 40));
        jPanel16.setLayout(new java.awt.GridLayout(1, 0, 30, 0));

        btnQuayLai.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images_Icon/arrow-left.png"))); // NOI18N
        btnQuayLai.setText("Quay Lại");
        btnQuayLai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnQuayLaiActionPerformed(evt);
            }
        });
        jPanel16.add(btnQuayLai);

        btnClear.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images_Icon/cleaning.png"))); // NOI18N
        btnClear.setText("Làm Mới");
        btnClear.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnClearActionPerformed(evt);
            }
        });
        jPanel16.add(btnClear);

        btnAdd.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images_Icon/add.png"))); // NOI18N
        btnAdd.setText("Thêm");
        btnAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAddActionPerformed(evt);
            }
        });
        jPanel16.add(btnAdd);

        jPanel17.add(jPanel16, java.awt.BorderLayout.CENTER);

        jPanel4.add(jPanel17, java.awt.BorderLayout.PAGE_END);

        jPanel28.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel28.setLayout(new java.awt.BorderLayout());

        jPanel23.setPreferredSize(new java.awt.Dimension(20, 186));

        javax.swing.GroupLayout jPanel23Layout = new javax.swing.GroupLayout(jPanel23);
        jPanel23.setLayout(jPanel23Layout);
        jPanel23Layout.setHorizontalGroup(
            jPanel23Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 20, Short.MAX_VALUE)
        );
        jPanel23Layout.setVerticalGroup(
            jPanel23Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );

        jPanel28.add(jPanel23, java.awt.BorderLayout.LINE_START);

        jPanel29.setPreferredSize(new java.awt.Dimension(876, 10));

        javax.swing.GroupLayout jPanel29Layout = new javax.swing.GroupLayout(jPanel29);
        jPanel29.setLayout(jPanel29Layout);
        jPanel29Layout.setHorizontalGroup(
            jPanel29Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 946, Short.MAX_VALUE)
        );
        jPanel29Layout.setVerticalGroup(
            jPanel29Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 10, Short.MAX_VALUE)
        );

        jPanel28.add(jPanel29, java.awt.BorderLayout.PAGE_START);

        jPanel30.setPreferredSize(new java.awt.Dimension(20, 186));

        javax.swing.GroupLayout jPanel30Layout = new javax.swing.GroupLayout(jPanel30);
        jPanel30.setLayout(jPanel30Layout);
        jPanel30Layout.setHorizontalGroup(
            jPanel30Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 20, Short.MAX_VALUE)
        );
        jPanel30Layout.setVerticalGroup(
            jPanel30Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );

        jPanel28.add(jPanel30, java.awt.BorderLayout.LINE_END);

        jPanel31.setPreferredSize(new java.awt.Dimension(876, 10));

        javax.swing.GroupLayout jPanel31Layout = new javax.swing.GroupLayout(jPanel31);
        jPanel31.setLayout(jPanel31Layout);
        jPanel31Layout.setHorizontalGroup(
            jPanel31Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 946, Short.MAX_VALUE)
        );
        jPanel31Layout.setVerticalGroup(
            jPanel31Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 10, Short.MAX_VALUE)
        );

        jPanel28.add(jPanel31, java.awt.BorderLayout.PAGE_END);

        jPanel27.setLayout(new java.awt.GridLayout(1, 0, 40, 0));

        jPanel18.setPreferredSize(new java.awt.Dimension(300, 301));
        jPanel18.setLayout(new java.awt.BorderLayout(15, 5));

        jScrollPane2.setPreferredSize(new java.awt.Dimension(452, 200));

        tblTheLoai.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null},
                {null, null},
                {null, null},
                {null, null}
            },
            new String [] {
                "Mã", "Thể Loại"
            }
        ));
        jScrollPane2.setViewportView(tblTheLoai);
        if (tblTheLoai.getColumnModel().getColumnCount() > 0) {
            tblTheLoai.getColumnModel().getColumn(0).setMaxWidth(100);
        }

        jPanel18.add(jScrollPane2, java.awt.BorderLayout.CENTER);

        jPanel26.setLayout(new java.awt.GridLayout(1, 0, 20, 0));

        btnChonTheLoai.setText("Chọn");
        btnChonTheLoai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnChonTheLoaiActionPerformed(evt);
            }
        });
        jPanel26.add(btnChonTheLoai);

        btnXoaTheLoai.setText("Xóa");
        btnXoaTheLoai.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXoaTheLoaiActionPerformed(evt);
            }
        });
        jPanel26.add(btnXoaTheLoai);

        jPanel18.add(jPanel26, java.awt.BorderLayout.PAGE_END);

        jPanel27.add(jPanel18);

        jPanel24.setLayout(new java.awt.BorderLayout(0, 5));

        tblTacGia.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null},
                {null, null},
                {null, null},
                {null, null}
            },
            new String [] {
                "Mã", "Tác Giả"
            }
        ));
        jScrollPane3.setViewportView(tblTacGia);
        if (tblTacGia.getColumnModel().getColumnCount() > 0) {
            tblTacGia.getColumnModel().getColumn(0).setMaxWidth(100);
        }

        jPanel24.add(jScrollPane3, java.awt.BorderLayout.CENTER);

        jPanel25.setLayout(new java.awt.GridLayout(1, 0, 20, 0));

        btnXoaTacGia.setText("Xóa");
        btnXoaTacGia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXoaTacGiaActionPerformed(evt);
            }
        });
        jPanel25.add(btnXoaTacGia);

        btnChonTacGia.setText("Chọn");
        btnChonTacGia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnChonTacGiaActionPerformed(evt);
            }
        });
        jPanel25.add(btnChonTacGia);

        jPanel24.add(jPanel25, java.awt.BorderLayout.PAGE_END);

        jPanel27.add(jPanel24);

        jPanel28.add(jPanel27, java.awt.BorderLayout.CENTER);

        jPanel4.add(jPanel28, java.awt.BorderLayout.CENTER);

        jPanelCapNhat.add(jPanel4, java.awt.BorderLayout.CENTER);

        jPanel32.setPreferredSize(new java.awt.Dimension(990, 10));

        javax.swing.GroupLayout jPanel32Layout = new javax.swing.GroupLayout(jPanel32);
        jPanel32.setLayout(jPanel32Layout);
        jPanel32Layout.setHorizontalGroup(
            jPanel32Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 990, Short.MAX_VALUE)
        );
        jPanel32Layout.setVerticalGroup(
            jPanel32Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 10, Short.MAX_VALUE)
        );

        jPanelCapNhat.add(jPanel32, java.awt.BorderLayout.PAGE_START);

        jPanel33.setPreferredSize(new java.awt.Dimension(990, 10));

        javax.swing.GroupLayout jPanel33Layout = new javax.swing.GroupLayout(jPanel33);
        jPanel33.setLayout(jPanel33Layout);
        jPanel33Layout.setHorizontalGroup(
            jPanel33Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 990, Short.MAX_VALUE)
        );
        jPanel33Layout.setVerticalGroup(
            jPanel33Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 10, Short.MAX_VALUE)
        );

        jPanelCapNhat.add(jPanel33, java.awt.BorderLayout.PAGE_END);

        jPanel34.setPreferredSize(new java.awt.Dimension(20, 797));

        javax.swing.GroupLayout jPanel34Layout = new javax.swing.GroupLayout(jPanel34);
        jPanel34.setLayout(jPanel34Layout);
        jPanel34Layout.setHorizontalGroup(
            jPanel34Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 20, Short.MAX_VALUE)
        );
        jPanel34Layout.setVerticalGroup(
            jPanel34Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 797, Short.MAX_VALUE)
        );

        jPanelCapNhat.add(jPanel34, java.awt.BorderLayout.LINE_END);

        jPanel35.setPreferredSize(new java.awt.Dimension(20, 797));

        javax.swing.GroupLayout jPanel35Layout = new javax.swing.GroupLayout(jPanel35);
        jPanel35.setLayout(jPanel35Layout);
        jPanel35Layout.setHorizontalGroup(
            jPanel35Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 20, Short.MAX_VALUE)
        );
        jPanel35Layout.setVerticalGroup(
            jPanel35Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 797, Short.MAX_VALUE)
        );

        jPanelCapNhat.add(jPanel35, java.awt.BorderLayout.LINE_START);

        jTabbedPane1.addTab("Cập nhật", jPanelCapNhat);

        add(jTabbedPane1, java.awt.BorderLayout.CENTER);
    }// </editor-fold>//GEN-END:initComponents

    private void btnAddNewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAddNewActionPerformed
        // TODO add your handling code here:
        btnAdd.setText("Thêm");
        resetForm();
        activeTabCapNhat();
    }//GEN-LAST:event_btnAddNewActionPerformed

    private void btnDetailsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDetailsActionPerformed
        // TODO add your handling code here:
        int row = tblSach.getSelectedRow();
        if (row == -1) {
            JOptionPane.showMessageDialog(this, "Hãy chọn sách cần xem!");
        } else {
            setForm(listSach.get(pageIndex).get(row));
            btnAdd.setText("Lưu");
            activeTabCapNhat();
        }


    }//GEN-LAST:event_btnDetailsActionPerformed

    private void btnLastActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLastActionPerformed
        // TODO add your handling code here:
        pageIndex = total;
        List<Sach> list = listSach.get(pageIndex);
        if (list == null) {
            list = sachDAO.selectByPage(Long.valueOf(pageIndex));
            listSach.put(pageIndex, list);
        }
        fillTableSach(listSach.get(pageIndex));
    }//GEN-LAST:event_btnLastActionPerformed

    private void btnNextActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnNextActionPerformed
        // TODO add your handling code here:
        if (pageIndex + 1 > total) {
            JOptionPane.showMessageDialog(this, "Bạn hiện đã ở trang cuối!");
        } else {
            pageIndex++;
            List<Sach> list = listSach.get(pageIndex);
            if (list == null) {
                list = sachDAO.selectByPage(Long.valueOf(pageIndex));
                listSach.put(pageIndex, list);
            }
            fillTableSach(listSach.get(pageIndex));
        }
    }//GEN-LAST:event_btnNextActionPerformed

    private void btnPrevActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPrevActionPerformed
        // TODO add your handling code here:
        if (pageIndex - 1 < 0) {
            JOptionPane.showMessageDialog(this, "Bạn hiện đã ở trang đầu!");
        } else {
            pageIndex--;
            List<Sach> list = listSach.get(pageIndex);
            if (list == null) {
                list = sachDAO.selectByPage(Long.valueOf(pageIndex));
                listSach.put(pageIndex, list);
            }
            fillTableSach(listSach.get(pageIndex));
        }
    }//GEN-LAST:event_btnPrevActionPerformed

    private void btnFirstActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnFirstActionPerformed
        // TODO add your handling code here:
        pageIndex = 0;
        fillTableSach(listSach.get(pageIndex));
    }//GEN-LAST:event_btnFirstActionPerformed

    private void cmbTheLoaiFilterActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbTheLoaiFilterActionPerformed
        // TODO add your handling code here:
        String itemSelected = cmbTheLoaiFilter.getSelectedItem() == null ? null : cmbTheLoaiFilter.getSelectedItem().toString();
        if (itemSelected != null) {
            Long maTheLoai = Long.valueOf(itemSelected.split("-")[0]);

            List<Sach> listSachByTheLoai = sachDAO.selectAllByTheLoai(maTheLoai);
            fillTableSach(listSachByTheLoai);
        }
    }//GEN-LAST:event_cmbTheLoaiFilterActionPerformed

    private void btnXoaTheLoaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXoaTheLoaiActionPerformed
        // TODO add your handling code here:
        if (theLoaiAdd.size() == 0) {
            JOptionPane.showMessageDialog(this, "Thể loại Trống!");
        } else {
            int row = tblTheLoai.getSelectedRow();
            if (row == -1) {
                JOptionPane.showMessageDialog(this, "Hãy chọn thể loại cần xóa!");
            } else {
                Long maTl = Long.valueOf(tblTheLoai.getValueAt(row, 0).toString());
                theLoaiAdd.remove(maTl);
                tableModelListTheLoais.removeRow(row);
            }
        }
    }//GEN-LAST:event_btnXoaTheLoaiActionPerformed

    private void btnChonTheLoaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnChonTheLoaiActionPerformed
        // TODO add your handling code here:
        ChonTacGiaVaTheLoai_JDialog.getInstance().show("THE_LOAI", null, listTheLoai);
    }//GEN-LAST:event_btnChonTheLoaiActionPerformed

    private void btnXoaTacGiaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXoaTacGiaActionPerformed
        // TODO add your handling code here:
        if (theLoaiAdd.size() == 0) {
            JOptionPane.showMessageDialog(this, "Tác  giả trống!");
        } else {
            int row = tblTacGia.getSelectedRow();
            if (row == -1) {
                JOptionPane.showMessageDialog(this, "Hãy chọn thể loại cần xóa!");
            } else {
                Long maTg = Long.valueOf(tblTacGia.getValueAt(row, 0).toString());
                tacGiaAdd.remove(maTg);
                tableModelListTacGia.removeRow(row);
            }
        }
    }//GEN-LAST:event_btnXoaTacGiaActionPerformed

    private void btnChonTacGiaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnChonTacGiaActionPerformed
        // TODO add your handling code here:
        ChonTacGiaVaTheLoai_JDialog.getInstance().show("TAC_GIA", listTacGia, null);
    }//GEN-LAST:event_btnChonTacGiaActionPerformed

    private void btnQuayLaiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnQuayLaiActionPerformed
        // TODO add your handling code here:
        jTabbedPane1.remove(jPanelCapNhat);
        jTabbedPane1.setSelectedIndex(0);
    }//GEN-LAST:event_btnQuayLaiActionPerformed

    private void cmbKhuVucActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbKhuVucActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cmbKhuVucActionPerformed

    private void btnClearActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnClearActionPerformed
        resetForm();
    }//GEN-LAST:event_btnClearActionPerformed

    private void btnAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAddActionPerformed
        Sach sach = getForm();
        if (sach != null) {
            if (sach.getId() == null) {
                Long id = Long.valueOf(sachDAO.insertOnUpdate(sach));

                if (id <= 0) {
                    JOptionPane.showMessageDialog(this, "Thêm thất bại!");
                } else {
                    JOptionPane.showMessageDialog(this, "Thêm thành công!");
                    sach.setId(id);
                    txtMaSach.setText(id.toString());
                    btnAdd.setText("Lưu");
                    updateSach(id);
                    String key = sach.getQr_code().split("-")[1];
                    String path = Helper.XImage.SACH_UPLOAD.concat("/" + key + ".png");
                    if (Helper.QR_CODE.generateQRcode(key, path)) {
                        try {
                            lblQr_Code.setIcon(new ImageIcon(
                                    new ImageIcon(path).getImage().getScaledInstance(185, 200, 1)
                            ));
                            btnDownload.setVisible(true);
                        } catch (Exception e) {
                            e.printStackTrace();
                            JOptionPane.showMessageDialog(this, "Không thể khởi tạo mã QR_CODE!");
                        }
                    }
                    listSach.clear();
                    pageIndex = 0;
                    listSach.put(pageIndex, sachDAO.selectByPage(Long.valueOf(pageIndex)));

                }
            } else {
                if (sachDAO.insertOnUpdate(sach) <= 0) {
                    JOptionPane.showMessageDialog(this, "Cập nhật thất bại!");
                } else {
                    updateSach(sach.getId());
                    JOptionPane.showMessageDialog(this, "Cập nhật thành công!");
                    List<Sach> list = listSach.get(pageIndex);
                    for (int i = 0; i < list.size(); ++i) {
                        if (list.get(i).getId().equals(sach.getId())) {
                            list.set(i, sach);
                            break;
                        }
                    }
                    listSach.replace(pageIndex, list);
                }
            }
        }
    }//GEN-LAST:event_btnAddActionPerformed

    public void updateSach(Long id) {
        new Thread() {
            @Override
            public void run() {
                tacGiaVaSachDao.delete(id);
                tacGiaAdd.forEach((x, y) -> {
                    if (tacGiaVaSachDao.insert(new TacGiaVaSach(id, x)) == 0) {
                        JOptionPane.showMessageDialog(null, "Lỗi cập nhật tác giả: " + listTacGia.get(x).getTenTacGia());
                    }
                });
            }
        }.start();
        new Thread() {
            @Override
            public void run() {
                theLoaiVaSachDao.delete(id);
                theLoaiAdd.forEach((x, y) -> {
                    if (theLoaiVaSachDao.insert(new TheLoaiVaSach(id, x)) == 0) {
                        JOptionPane.showMessageDialog(null, "Lỗi cập nhật thể loại: " + listTheLoai.get(x).getTenTheLoai());
                    }
                });
            }
        }.start();
    }

    private void btnSearchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSearchActionPerformed
        // TODO add your handling code here:
        String search = txtSearch.getText();
        if (search.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Hãy nhập thông tin cần tìm kiếm");
        } else {
            search = "%" + search + "%";
            List<Sach> listSearch = sachDAO.searchByKey(search);
            if (listSearch == null) {
                JOptionPane.showMessageDialog(this, "Không tìm thấy sách nào!");
            } else {
                fillTableSach(listSearch);
            }
        }
    }//GEN-LAST:event_btnSearchActionPerformed

    private void btnLamMoiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLamMoiActionPerformed
        // TODO add your handling code here:
        pageIndex = 0;
        cmbNhaXuatBan.setSelectedIndex(0);
        fillTableSach(listSach.get(pageIndex));

    }//GEN-LAST:event_btnLamMoiActionPerformed

    private void txtTenSachActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtTenSachActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTenSachActionPerformed

    private void btnNhaXuatBanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnNhaXuatBanActionPerformed
        this.updateTacGia();
    }//GEN-LAST:event_btnNhaXuatBanActionPerformed

    private void btnNhapSachActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnNhapSachActionPerformed
        // TODO add your handling code here:
        Home_Frame.getInstance().activePanel("QLNHAPSACH");
    }//GEN-LAST:event_btnNhapSachActionPerformed

    private void btnDownloadActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDownloadActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnDownloadActionPerformed

    void updateTacGia() {
        String tenTg = MsgBox.prompt(this, "Nhập tên nhà xuất bản muốn thêm!");
        if (tenTg == null) {
            return;
        }
        if (tenTg.equals("")) {
            MsgBox.alert_WARNING(this, "Không được để trống");
            return;
        }
        if (!this.nhaXuatBanDao.selectByKeyWorld(tenTg).isEmpty()) {
            MsgBox.alert_WARNING(this, "Tên tác giả đã tồn tại");
            return;
        }

        NhaXuatBan nxb = new NhaXuatBan(null, tenTg.trim());
        int row = this.nhaXuatBanDao.insert(nxb);
        if (row > 0) {
            MsgBox.alert_INFORMATION(this, "Thêm thành công!");
            this.fillCmbNhaXuatBan();
        } else {
            MsgBox.alert_ERROR(this, "Update thất bại!");
        }
    }

    public void activeTabCapNhat() {
        jTabbedPane1.add(jPanelCapNhat, "Cập Nhật");
        jTabbedPane1.setSelectedIndex(1);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAdd;
    private javax.swing.JButton btnAddNew;
    private javax.swing.JButton btnChonTacGia;
    private javax.swing.JButton btnChonTheLoai;
    private javax.swing.JButton btnClear;
    private javax.swing.JButton btnDetails;
    private javax.swing.JButton btnDownload;
    private javax.swing.JButton btnFirst;
    private javax.swing.JButton btnLamMoi;
    private javax.swing.JButton btnLast;
    private javax.swing.JButton btnNext;
    private javax.swing.JButton btnNhaXuatBan;
    private javax.swing.JButton btnNhapSach;
    private javax.swing.JButton btnPrev;
    private javax.swing.JButton btnQuayLai;
    private javax.swing.JButton btnSearch;
    private javax.swing.JButton btnXoaTacGia;
    private javax.swing.JButton btnXoaTheLoai;
    private javax.swing.JComboBox<String> cmbKhuVuc;
    private javax.swing.JComboBox<String> cmbNhaXuatBan;
    private javax.swing.JComboBox<String> cmbTheLoaiFilter;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel13;
    private javax.swing.JPanel jPanel14;
    private javax.swing.JPanel jPanel15;
    private javax.swing.JPanel jPanel16;
    private javax.swing.JPanel jPanel17;
    private javax.swing.JPanel jPanel18;
    private javax.swing.JPanel jPanel19;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel20;
    private javax.swing.JPanel jPanel21;
    private javax.swing.JPanel jPanel22;
    private javax.swing.JPanel jPanel23;
    private javax.swing.JPanel jPanel24;
    private javax.swing.JPanel jPanel25;
    private javax.swing.JPanel jPanel26;
    private javax.swing.JPanel jPanel27;
    private javax.swing.JPanel jPanel28;
    private javax.swing.JPanel jPanel29;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel30;
    private javax.swing.JPanel jPanel31;
    private javax.swing.JPanel jPanel32;
    private javax.swing.JPanel jPanel33;
    private javax.swing.JPanel jPanel34;
    private javax.swing.JPanel jPanel35;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JPanel jPanelCapNhat;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JLabel lblErrorTenSach;
    private javax.swing.JLabel lblMaSach;
    private javax.swing.JLabel lblNhaXuatBan1;
    private javax.swing.JLabel lblQr_Code;
    private javax.swing.JLabel lblTenSach;
    private javax.swing.JLabel lblViTri;
    private javax.swing.JTable tblSach;
    private javax.swing.JTable tblTacGia;
    private javax.swing.JTable tblTheLoai;
    private javax.swing.JTextField txtMaSach;
    private javax.swing.JTextField txtSearch;
    private javax.swing.JTextField txtTenSach;
    // End of variables declaration//GEN-END:variables

    private void resetForm() {
        txtMaSach.setText(null);
        txtTenSach.setText(null);
        lblErrorTenSach.setText(null);
        cmbKhuVuc.setSelectedIndex(0);
        cmbNhaXuatBan.setSelectedIndex(0);
        lblQr_Code.setIcon(null);
        btnDownload.setVisible(false);

        tacGiaAdd.clear();
        theLoaiAdd.clear();
        tableModelListTacGia.setRowCount(0);
        tableModelListTheLoais.setRowCount(0);
    }

    private void fillCmbKhuVuc() {
        boxModelKhuVuc.removeAllElements();;
        boxModelKhuVuc.addElement("Khu A");
        boxModelKhuVuc.addElement("Khu B");
        boxModelKhuVuc.addElement("Khu C");
        boxModelKhuVuc.addElement("Khu D");
        boxModelKhuVuc.addElement("Khu E");

    }

    private void fillCmbNhaXuatBan() {
        boxModelNhaXuatBan.removeAllElements();
        this.listNhaXuatBan = nhaXuatBanDao.selectALL();
        if (listNhaXuatBan != null) {
            listNhaXuatBan.forEach((nxb) -> boxModelNhaXuatBan.addElement(nxb.getId() + "-" + nxb.getTenNhaXuatBan()));
        }
    }

    private void fillTableSach(List<Sach> list) {
        tableModelListSach.setRowCount(0);
        if (list != null) {
            list.forEach((s) -> {
                tableModelListSach.addRow(new Object[]{
                    s.getId(),
                    s.getTenSach(),
                    s.getViTri(),
                    s.getNgayTao()
                });
            });
        }
    }

    private void setForm(Sach sach) {
        txtMaSach.setText(sach.getId().toString());
        txtTenSach.setText(sach.getTenSach());
        cmbKhuVuc.setSelectedItem(sach.getViTri());

        tableModelListTacGia.setRowCount(0);
        tableModelListTheLoais.setRowCount(0);

        new Thread() {
            @Override
            public void run() {
                List<TacGiaVaSach> tacGiaVaSachs = tacGiaVaSachDao.selectALLBySach(sach.getId());
                if (tacGiaVaSachs != null) {
                    tacGiaVaSachs.forEach((tg) -> {
                        tacGiaAdd.put(tg.getTacGia(), tg.getSach());
                        tableModelListTacGia.addRow(new Object[]{tg.getTacGia(), listTacGia.get(tg.getTacGia()).getTenTacGia()});
                    });
                }
            }
        }.start();
        new Thread() {
            @Override
            public void run() {
                List<TheLoaiVaSach> theLoaiVaSachs = theLoaiVaSachDao.selectALLBySach(sach.getId());
                if (theLoaiVaSachs != null) {
                    theLoaiVaSachs.forEach((tl) -> {
                        theLoaiAdd.put(tl.getTheLoai(), tl.getSach());

                        tableModelListTheLoais.addRow(new Object[]{tl.getTheLoai(), listTheLoai.get(tl.getTheLoai()).getTenTheLoai()});
                    });
                }
            }
        }.start();

        for (int i = 0; i < listNhaXuatBan.size(); ++i) {
            NhaXuatBan nxb = listNhaXuatBan.get(i);
            if (sach.getNhaXuatBan() == nxb.getId()) {
                cmbNhaXuatBan.setSelectedItem(nxb.getId() + "-" + nxb.getTenNhaXuatBan());
                break;
            }
        }
        if (sach.getQr_code()
                != null) {
            try {
                lblQr_Code.setIcon(new ImageIcon(
                        new ImageIcon(Helper.XImage.SACH_UPLOAD.concat("/" + sach.getQr_code().split("-")[1] + ".png")).
                                getImage().
                                getScaledInstance(185, 200, 1)));
                btnDownload.setVisible(true);
            } catch (Exception e) {
                JOptionPane.showMessageDialog(this, "Không tìm thấy qr_code");
            }
        }
    }

    private void loadList() {
        List<TheLoai> listTl = theLoaiDao.selectALL();
        listTl.forEach(tl -> {
            listTheLoai.put(tl.getId(), tl);
        });

        List<TacGia> listTg = tacGiaDao.selectALL();
        listTg.forEach(tg -> {
            listTacGia.put(tg.getId(), tg);
        });
    }

    private void fillCmbTheLoai() {
        boxModelTheLoai.removeAllElements();
        listTheLoai.forEach((x, y) -> {
            boxModelTheLoai.addElement(y.getId() + "-" + y.getTenTheLoai());
        });
        cmbTheLoaiFilter.setModel(boxModelTheLoai);
    }

    public boolean addTacGia(Long id) {
        if (tacGiaAdd.containsKey(id)) {
            return false;
        }
        tacGiaAdd.put(id, null);
        tableModelListTacGia.addRow(new Object[]{id, listTacGia.get(id).getTenTacGia()});
        return true;
    }

    public boolean addTheLoai(Long id) {
        if (theLoaiAdd.containsKey(id)) {
            return false;
        }
        theLoaiAdd.put(id, null);
        tableModelListTheLoais.addRow(new Object[]{id, listTheLoai.get(id).getTenTheLoai()});
        return true;
    }

    private Sach getForm() {
        String tenSach = txtTenSach.getText();
        int check = 0;
        if (tenSach.isEmpty()) {
            System.out.println("hêr");
            lblErrorTenSach.setText("Tên sách không được bỏ trống");
        } else if (tenSach.length() > 255) {
            lblErrorTenSach.setText("Tên sách không được quá 255 ký tự");
        } else {
            check++;
            lblErrorTenSach.setText(null);
        }

        Sach sach = null;

        if (check == 1) {
            if (tacGiaAdd.size() == 0) {
                JOptionPane.showMessageDialog(this, "Hãy chọn tác giả!");
            } else if (theLoaiAdd.size() == 0) {
                JOptionPane.showMessageDialog(this, "Hãy chọn thể loại!");
            } else {
                sach = new Sach();
                Long maSach = txtMaSach.getText().isEmpty() ? null : Long.valueOf(txtMaSach.getText());
                String viTri = cmbKhuVuc.getSelectedItem().toString();
                Long nhaXuatBan = Long.valueOf(cmbNhaXuatBan.getSelectedItem().toString().split("-")[0]);

                Long timeNow = Calendar.getInstance().getTimeInMillis();

                sach.setNguoiTao(Helper.Auth.user.getMaQL());
                sach.setTrangThai(true);
                sach.setId(maSach);
                sach.setViTri(viTri);
                sach.setTenSach(tenSach);
                sach.setNhaXuatBan(nhaXuatBan);

                int row = tblSach.getSelectedRow();
                if (row == -1) {
                    sach.setNgayTao(new Date(timeNow));
                    sach.setQr_code("sach-" + timeNow.toString());
                } else {
                    Sach s = listSach.get(pageIndex).get(row);
                    sach.setQr_code(s.getQr_code());
                    sach.setNgayTao(s.getNgayTao());
                }
            }
        }
        return sach;
    }

    public void showSach(String data) {
        Sach sach = sachDAO.findByQR("sach-".concat(data));
        if (sach != null) {
            btnAdd.setText("Lưu");
            setForm(sach);
            activeTabCapNhat();
            Home_Frame.getInstance().activePanel("QLSACH");
        }
    }
}
